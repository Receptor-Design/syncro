"use strict";(self.webpackJSONPwpmdb=self.webpackJSONPwpmdb||[]).push([[827],{827:(e,a,t)=>{t.r(a),t.d(a,{importFile:()=>u,setImportTableData:()=>c,uploadFileActions:()=>d});var r=t(1581),i=t(6486),n=t(6487),l=t(3933),s=t(533),o=t(8047),p=t(5723),m=t(369),c=e=>(a,t)=>a((0,n.b)(m.Tk,e)),u=e=>async(a,t)=>{var p,m=(0,r.vg)("import_gzipped",t()),_=(0,i.selectFromImportData)("file_size",t()),f={chunk:e.chunk,current_query:e.current_query,import_file:e.import_filename};f.import_info=JSON.stringify({import_gzipped:m});try{p=await(0,o.ty)("/import-file",f)}catch(g){return a((0,s.zh)(g)),!1}var d=p.data,b=d.table_sizes,y=d.table_rows,h=d.tables;a(c({table_sizes:b,table_rows:y,tables:h}));var w=Math.ceil(_/d.num_chunks)/1e3;if(a((0,s.Bz)(w)),d.chunk>=d.num_chunks)return a((0,s.Ad)()),a((0,n.b)(l.kl,"import")),a((0,s.GD)("MIGRATE",[],"find_replace"));var z=[{import_filename:e.import_filename,item_name:e.item_name,chunk:d.chunk,current_query:d.current_query}];return await a((0,s.GD)("IMPORT_FILE",[{fn:u,args:z}]))},_=1024e3,f=e=>async(a,t)=>{var r;a((0,n.b)(l.Ad,"import")),a((0,n.b)(p.XY));try{r=await(0,o.ty)("/prepare-upload",{})}catch(_){return a((0,s.zh)(_)),!1}var i=e.name,m=window.wpmdb_strings.importing_file_to_db.replace(/%s\s?/,i);a((0,n.b)(p.ks,m)),".gz"===i.slice(-3)&&(i=e.name.slice(0,-3));var c=[{import_filename:r.data.import_file,item_name:i,chunk:0,current_query:""}];return await a((0,s.GD)(s.Jt,[{fn:u,args:c}]))},d=e=>async(a,t)=>{var p=(0,r.jG)("remote_site",t());e="undefined"===typeof e?0:e;var m=(0,i.selectFromImportData)("file",t()),c=e+_+1,u=new FileReader;0===e&&(a((0,n.b)(l.Ad,"upload")),a((0,s.oE)(Math.ceil((0,i.selectFromImportData)("file_size",t())/1e3)))),u.onloadend=async function(t){if(t.target.readyState===FileReader.DONE){var r={action:"wpmdb_upload_file",file_data:t.target.result,file:m.name,file_type:m.type,stage:"import",import_info:p};try{await(0,o.ty)("/upload-file",r)}catch(u){return a((0,s.zh)(u)),!1}if(c<m.size)return a((0,s.Bz)(Math.ceil(1024))),await a((0,s.GD)(s.oH,[{fn:d,args:[c]}]));var i=m.size-e;return a((0,s.Bz)(Math.ceil(i/1e3))),a((0,n.b)(l.kl,"upload")),await a((0,s.GD)(s.fU,[{fn:f,args:[m]}]))}};var b=m.slice(e,c);u.readAsDataURL(b)}}}]);